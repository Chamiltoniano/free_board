
<!DOCTYPE html>
<html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.2.61/jspdf.debug.js"></script>
<script type="text/javascript">

  var xx,yy;
    function foto0(entero) {
      //alert(entero);
      xx=Math.ceil(1366*window.innerWidth/1366);
      yy=Math.ceil(768*window.innerHeight/768);
     document.getElementById("paint").style.background = "url("+entero+")"; //
    document.getElementById("paint").style.backgroundSize = ""+xx+"px "+yy+"px";
    }

</script>

<head>
   <link href="stylecalculadora.css" rel="stylesheet" type="text/css"/>
  <script src="scriptcalculadora.js"></script>
<style>
*{font-family:sans-serif;}


#paint {border: 1px solid black; margin-left: auto; margin-right: auto; display: block;}

#container > div
{
    display: inline-block;
    margin: 0px 0px;
}
#container0
{
    display: inline-block;
    padding: 0px 0px;
    margin: 0px 0px;
}
#container1
{
    display: inline-block;
    background-color: lightblue;
    margin: 0px 0px;
}
#container2
{
    display: inline-block;
    padding: 0px 10px;
    margin: 0px 0px;
}
#container3
{
    display: inline-block;
    background-color: lightblue;
    margin: 0px 0px;
}
#container4
{
    display: inline-block;
    background-color: lightblue;
    margin: 0px 0px;
}
#container5
{
    display: inline-block;
    background-color: lightgreen;
    margin: 0px 0px;
}
#container6
{
    display: inline-block;
    background-color: lightblue;
    margin: 0px 0px;
}
#container
{
    text-align: center;
     background-color:lightblue;
    margin: 0px 0px;
    width: 100%;
}  

</style>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<link rel="icon" 
      type="image/ico" 
      href="favicon.ico">
</head>
<body style="background-color:#C0C0C0; margin: 0px 0px;">


<div id="container">
      <div id="container0" >
      <img src="logo2.png"  width="150" height="25" style="">
  </div>
    <div id="container1">
  <button onclick="getColor('black');" style="width:20px;height:20px;background:black;"></button>
  <button onclick="getColor('blue');" style="width:20px;height:20px;background:blue;"></button>
  <button onclick="getColor('red');" style="width:20px;height:20px;background:red;"></button>
  <button onclick="getColor('yellow');" style="width:20px;height:20px;background:yellow;"></button>
  <button onclick="getColor('green');" style="width:20px;height:20px;background:green;"></button>
  <img src="borrador.jpg"  width="40" height="25" onclick="getBorrador()" style="" title="Borrador">
    </div>
    <div id="container2" >
      Tamaño de pincel:  <span id="demo"></span>
  </div>
  <div id="container2" style="padding: 0px 0px;  margin: 0px 0px;">
  <input type="range" min="1" max="9" value="1" id="myRange"  style="padding: 0px 0px;  margin: 0px 0px;">
  </div>
  <div id="container3" >
         <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal1" style="font-size:medium;  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 5px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 15px;">Elegir fondo</button>
  </div>
  <div id="container3" >
      <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" style=" font-size:medium;  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 5px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 15px;">Subir imagen de fondo</button>
  </div>


  <div id="container1" >
      <img src="save.jpg"  width="30" height="30" onclick="save()" style="" title="Guardar como PDF">
  </div>

  <div id="container1" style="padding: 5px 0px;">
  <input type="button" value="Limpiar todo" id="clr" size="23" onclick="erase()" style="">
  </div>
  <div id="container1" >
      <img src="calculadora.png"  width="30" height="30" data-toggle="modal" data-target="#myModal2" title="Calculadora">
  </div>

    <div id="container1" >
       <a href="https://www.geogebra.org/calculator"><img src="graficadora.png"  width="30" height="30" data-toggle="modal" data-target="#myModal3" title="Graficador de funciones"></a>
    </div>


  <div id="container6" style="padding: 5px 0px; font-weight: bold;">
 Prof: 
  </div>
</div>

<div id="sketch">
  <canvas id="paint" style="background-color:white;  touch-action: none;"></canvas>
</div>

<!--///////////////////////////////////////////////////////////////////////////////////////////////////-->
 <!-- Modal -->
  <div class="modal fade" id="myModal1" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Elegir imagen de fondo</h4>
        </div>
<div id="imagenes-fondo" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px;">
  <!-- Aquí se cargarán las imágenes -->
</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
<!--///////////////////////////////////////////////////////////////////////////////////////////////////-->
  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Subir imagen de fondo</h4>
        </div>
<form id="uploadForm">
  Añadir imagen: <input name="archivo" id="archivo" type="file" required />
  <input type="button" value="Subir imagen" onclick="subirImagen()" />
</form>
<div id="mensaje-subida" style="margin-top: 10px; font-weight: bold;"></div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

<!--///////////////////////////////////////////////////////////////////////////////////////////////////-->

<!--///////////////////////////////////////////////////////////////////////////////////////////////////-->
  <!-- Modal -->
  <div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Calculadora</h4>
        </div>
         <script language="javascript">
    
    function addChar(input, character) {
  if(input.value == null || input.value == "0")
    input.value = character
  else
    input.value += character
}

function cos(form) {
  form.display.value = Math.cos(form.display.value);
}

function sin(form) {
  form.display.value = Math.sin(form.display.value);
}

function tan(form) {
  form.display.value = Math.tan(form.display.value);
}

function sqrt(form) {
  form.display.value = Math.sqrt(form.display.value);
}

function ln(form) {
  form.display.value = Math.log(form.display.value);
}

function exp(form) {
  form.display.value = Math.exp(form.display.value);
}

function deleteChar(input) {
  input.value = input.value.substring(0, input.value.length - 1)
}
var val = 0.0;
function percent(input) {
  val = input.value;
  input.value = input.value + "%";
}

function changeSign(input) {
  if(input.value.substring(0, 1) == "-")
    input.value = input.value.substring(1, input.value.length)
  else
    input.value = "-" + input.value
}

function compute(form) {
  //if (val !== 0.0) {
   // var percent = form.display.value;  
   // percent = pcent.substring(percent.indexOf("%")+1);
   // form.display.value = parseFloat(percent)/100 * val;
    //val = 0.0;
 // } else 
    form.display.value = eval(form.display.value);
  }


function square(form) {
  form.display.value = eval(form.display.value) * eval(form.display.value)
}

function checkNum(str) {
  for (var i = 0; i < str.length; i++) {
    var ch = str.charAt(i);
    if (ch < "0" || ch > "9") {
      if (ch != "/" && ch != "*" && ch != "+" && ch != "-" && ch != "."
        && ch != "(" && ch!= ")" && ch != "%") {
        alert("invalid entry!")
        return false
        }
      }
    }
    return true
}
  </script>
    <style>   
* {
  padding: 0;
  margin: 5px;
  text-align: center;
}
body {
  background-color:blue;
}
.calculator {
  width: 350px;
  height: 320px;
  background-color: #c0c0c0;
  box-shadow: 0px 0px 0px 10px #666;
  border: 5px solid black;
  border-radius: 10px;
}
#display {
  width: 320px;
  height: 40px;
  text-align: right;
  background-color: black;
  border: 3px solid white;
  font-size: 18px;
  left: 2px;
  top: 2px;
  color: #7fff00;
}
.btnTop{
  color: white;
  background-color: #6f6f6f;
  font-size: 14px;
  margin: auto;
  width: 50px;
  height: 25px;
}
.btnNum {
  color: white;
  background-color: black;
  font-size: 14px;
  margin: auto;
  width: 50px;
  height: 25px;
}
.btnMath {
  color: white;
  background-color: blue;
  font-size: 14px;
  margin: auto;
  width: 50px;
  height: 25px;
}
.btnOpps {
  color: white;
  background-color: #ff9933;
  font-size: 14px;
  margin: auto;
  width: 50px;
  height: 25px;
}
    </style>
<form name="sci-calc">
 <table class="calculator" cellspacing="0" cellpadding="1">
   <tr>
     <td colspan="5"><input id="display" name="display" value="0" size="28" maxlength="25"></td>
   </tr>
   <tr>
     <td><input type="button" class="btnTop" name="btnTop" value="C" onclick="this.form.display.value=  0 "></td>
     <td><input type="button" class="btnTop" name="btnTop" value="<--" onclick="deleteChar(this.form.display)"></td>
     <td><input type="button" class="btnTop" name="btnTop" value="=" onclick="if(checkNum(this.form.display.value)) { compute(this.form) }"></td>
     <td><input type="button" class="btnOpps" name="btnOpps" value="&#960;" onclick="addChar(this.form.display,'3.14159265359')"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="%" onclick=" percent(this.form.display)"></td>
   </tr>
   <tr>
     <td><input type="button" class="btnNum" name="btnNum" value="7" onclick="addChar(this.form.display, '7')"></td>
     <td><input type="button" class="btnNum" name="btnNum" value="8" onclick="addChar(this.form.display, '8')"></td>
     <td><input type="button" class="btnNum" name="btnNum" value="9" onclick="addChar(this.form.display, '9')"></td>
     <td><input type="button" class="btnOpps" name="btnOpps" value="x&#94;" onclick="if(checkNum(this.form.display.value)) { exp(this.form) }"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="/" onclick="addChar(this.form.display, '/')"></td>
   <tr>
     <td><input type="button" class="btnNum" name="btnNum" value="4" onclick="addChar(this.form.display, '4')"></td>
     <td><input type="button" class="btnNum" name="btnNum" value="5" onclick="addChar(this.form.display, '5')"></td>
     <td><input type="button" class="btnNum" name="btnNum" value="6" onclick="addChar(this.form.display, '6')"></td>
     <td><input type="button" class="btnOpps" name="btnOpps" value="ln" onclick="if(checkNum(this.form.display.value)) { ln(this.form) }"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="*" onclick="addChar(this.form.display, '*')"></td>
   </tr>
   <tr>
     <td><input type="button" class="btnNum" name="btnNum" value="1" onclick="addChar(this.form.display, '1')"></td>
     <td><input type="button" class="btnNum" name="btnNum" value="2" onclick="addChar(this.form.display, '2')"></td>
     <td><input type="button" class="btnNum" name="btnNum" value="3" onclick="addChar(this.form.display, '3')"></td>
     <td><input type="button" class="btnOpps" name="btnOpps" value="&radic;" onclick="if(checkNum(this.form.display.value)) { sqrt(this.form) }"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="-" onclick="addChar(this.form.display, '-')"></td>
   </tr>
   <tr>
     <td><input type="button" class="btnMath" name="btnMath" value="&#177" onclick="changeSign(this.form.display)"></td>
     <td><input type="button" class="btnNum" name="btnNum" value="0" onclick="addChar(this.form.display, '0')"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="&#46;" onclick="addChar(this.form.display, '&#46;')"></td>
     <td><input type="button" class="btnOpps" name="btnOpps" value="x&#50;" onclick="if(checkNum(this.form.display.value)) { square(this.form) }"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="+" onclick="addChar(this.form.display, '+')"></td>
   </tr>
   <tr>
     <td><input type="button" class="btnMath" name="btnMath" value="(" onclick="addChar(this.form.display, '(')"></td>
     <td><input type="button" class="btnMath" name="btnMath" value=")" onclick="addChar(this.form.display,')')"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="cos" onclick="if(checkNum(this.form.display.value)) { cos(this.form) }"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="sin" onclick="if(checkNum(this.form.display.value)) { sin(this.form) }"></td>
     <td><input type="button" class="btnMath" name="btnMath" value="tan" onclick="if(checkNum(this.form.display.value)) { tan(this.form) }"></td>
  </tr>
 </tabel>
</form>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!--///////////////////////////////////////////////////////////////////////////////////////////////////-->


</body>
</html> 
 <script type="text/javascript">
var canvas = document.getElementById('paint');
var ctx = canvas.getContext("2d");
   var     w = 94*window.innerWidth/100;
   var     h = 90*window.innerHeight/100;
///////////////////////////77
  var history = {
    redo_list: [],
    undo_list: [],
    saveState: function(canvas, list, keep_redo) {
      keep_redo = keep_redo || false;
      if(!keep_redo) {
        this.redo_list = [];
      }
      
      (list || this.undo_list).push(canvas.toDataURL());   
    },
    undo: function(canvas, ctx) {
      this.restoreState(canvas, ctx, this.undo_list, this.redo_list);
    },
    redo: function(canvas, ctx) {
      this.restoreState(canvas, ctx, this.redo_list, this.undo_list);
    },
    restoreState: function(canvas, ctx,  pop, push) {
      if(pop.length) {
        this.saveState(canvas, push, true);
        var restore_state = pop.pop();
        var img = new Element('img', {'src':restore_state});
        img.onload = function() {
          ctx.clearRect(0, 0, w, h);
          ctx.drawImage(img, 0, 0, w, h, 0, 0, w, h);  
        }
      }
    }
  }

///////////////////////////

  function save() {
    
        var dataURL = canvas.toDataURL();
  var pdf = new jsPDF("l", "mm", "a4");
      xx=Math.ceil(1366*window.innerWidth/1366);
      yy=Math.ceil(768*window.innerHeight/768);
  pdf.addImage(dataURL, 'PNG', 0, 0);
  pdf.save("download.pdf");
    }



    function erase() {
        var m = confirm("Borrar todo");
        if (m) {
            ctx.clearRect(0, 0, w, h);
            document.getElementById("canvasimg").style.display = "none";
        }
    }
 
var sketch = document.getElementById('sketch');
var sketch_style = getComputedStyle(sketch);
canvas.width = 94*window.innerWidth/100;
canvas.height = 90*window.innerHeight/100;

var mouse = {x: 0, y: 0};
 

/* Mouse Capturing Work */

canvas.addEventListener('pointermove', function(e) {
  mouse.x = e.pageX - this.offsetLeft;
  mouse.y = e.pageY - this.offsetTop;
}, false);
canvas.addEventListener('mousemove', function(e) {
  mouse.x = e.pageX - this.offsetLeft;
  mouse.y = e.pageY - this.offsetTop;
}, false);

/* Drawing on Paint App */
ctx.lineJoin = 'round';
ctx.lineCap = 'round';

ctx.strokeStyle = "black";
function getColor(colour){ctx.strokeStyle = colour;
ctx.globalCompositeOperation = "source-over";
ctx.lineWidth =2*output.innerHTML;
}
function getBorrador(){
                  //ctx.strokeStyle = "white";
                  ctx.lineWidth =40;
                ctx.globalCompositeOperation = "destination-out";  
    ctx.strokeStyle = "rgba(255,255,255,1)";
                      }

//function getSize(size){ctx.lineWidth = size;}

var slider = document.getElementById("myRange");
var output = document.getElementById("demo");
output.innerHTML = slider.value;

slider.oninput = function() {
  output.innerHTML = this.value;
  ctx.lineWidth =2*output.innerHTML;
//console.log(Y);
}


//ctx.strokeStyle = 
//ctx.strokeStyle = document.settings.colour[1].value;

canvas.addEventListener('pointerdown', function(e) {
    ctx.beginPath();
    ctx.moveTo(mouse.x, mouse.y);
 //history.saveState(this.canvas);
    canvas.addEventListener('pointermove', onPaint, false);
}, false);
 
canvas.addEventListener('pointerup', function() {
    canvas.removeEventListener('pointermove', onPaint, false);
    cPush();
}, false);
 
canvas.addEventListener('mousedown', function(e) {
    ctx.beginPath();
    ctx.moveTo(mouse.x, mouse.y);
 //history.saveState(this.canvas);
    canvas.addEventListener('mousemove', onPaint, false);
}, false);
 
canvas.addEventListener('mouseup', function() {
    canvas.removeEventListener('mousemove', onPaint, false);
    cPush();
}, false);
 
var onPaint = function() {
    ctx.lineTo(mouse.x, mouse.y);
    ctx.stroke();
};

window.onload = function() {
  ctx.clearRect(0, 0, w, h);
  window.addEventListener('keydown', handleKeys);
}

history.saveState(canvas);

function handleKeys(evt) {
  if (evt.ctrlKey && evt.key === 'z') {
    // console.log('undo');
//var mm = confirm(cStep);

history.undo(canvas, ctx);
    // Remove the most recent command from the list
/*    commands.splice(-1, 1);

    // Clear canvas
    cC.clearRect(0, 0, w, h);

    // Re-play all commands (re-draw canvas from scratch)
    commands.forEach(function (command) {
      execute.apply(null, command);
    });*/
  }
}


  $('#myModal1').on('show.bs.modal', function () {
    fetch('/list_uploads')
      .then(res => res.json())
      .then(files => {
        const contenedor = document.getElementById('imagenes-fondo');
        contenedor.innerHTML = '';
        files.forEach(url => {
          const img = document.createElement('img');
          img.src = url;
          img.style.width = '100px';
          img.style.cursor = 'pointer';
          img.title = "Usar como fondo";
          img.onclick = () => {
            foto0(url);  // ya tenés definida esta función
            $('#myModal1').modal('hide');
          };
          contenedor.appendChild(img);
        });
      });
  });
 

function subirImagen() {
  const archivoInput = document.getElementById('archivo');
  const archivo = archivoInput.files[0];
  const mensaje = document.getElementById('mensaje-subida');

  if (!archivo) {
    mensaje.textContent = "Por favor selecciona una imagen.";
    return;
  }

  const formData = new FormData();
  formData.append('archivo', archivo);

  fetch('/upload', {
    method: 'POST',
    body: formData
  })
  .then(res => {
    if (!res.ok) throw new Error("Error en subida");
    return res.text();
  })
  .then(text => {
    mensaje.textContent = "Imagen subida correctamente.";
    archivoInput.value = "";
    // recargar imágenes del modal
    if ($('#myModal1').hasClass('in')) {
      $('#myModal1').modal('hide');  // ocultar si estaba abierto
    }
  })
  .catch(err => {
    mensaje.textContent = "Hubo un error al subir la imagen.";
  });
}
 
      </script>